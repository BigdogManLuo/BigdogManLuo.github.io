<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="English Version 中文版 记录第一次跨界参加超过全球三千支队伍的量化交易竞赛（Kaggle Hull-Tactical Market Prediction）的经历，并分享一下我的方案。虽然此前已经参加过两次正式的时间序列预测竞赛(且都拿到了冠军)，但是这么大规模、竞争激烈的比赛还是头一次。 这场比赛与HEFTCom的赛制相似，完全双盲的评估（预测未来的股票市场收益率并每日调整仓位）。">
<meta property="og:type" content="article">
<meta property="og:title" content="第一次参加量化交易竞赛的方案分享：关于概率预测与优化、端对端学习、与预测实践的心态">
<meta property="og:url" content="https://bigdogmanluo.github.io/2025/12/23/zh/summary_hull_tac-zh/index.html">
<meta property="og:site_name" content="Try to Understand">
<meta property="og:description" content="English Version 中文版 记录第一次跨界参加超过全球三千支队伍的量化交易竞赛（Kaggle Hull-Tactical Market Prediction）的经历，并分享一下我的方案。虽然此前已经参加过两次正式的时间序列预测竞赛(且都拿到了冠军)，但是这么大规模、竞争激烈的比赛还是头一次。 这场比赛与HEFTCom的赛制相似，完全双盲的评估（预测未来的股票市场收益率并每日调整仓位）。">
<meta property="og:locale">
<meta property="og:image" content="https://bigdogmanluo.github.io/2025/12/23/zh/summary_hull_tac-zh/walk_forward_score_distribution.png">
<meta property="article:published_time" content="2025-12-22T16:00:00.000Z">
<meta property="article:modified_time" content="2025-12-23T09:20:37.184Z">
<meta property="article:author" content="BigdogManLuo">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://bigdogmanluo.github.io/2025/12/23/zh/summary_hull_tac-zh/walk_forward_score_distribution.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>第一次参加量化交易竞赛的方案分享：关于概率预测与优化、端对端学习、与预测实践的心态</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="https://bigdogmanluo.github.io/academic-homepage/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2025/12/23/en/summary_hull_tac-en/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2025/11/30/undefined/Backtest/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://bigdogmanluo.github.io/2025/12/23/zh/summary_hull_tac-zh/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://bigdogmanluo.github.io/2025/12/23/zh/summary_hull_tac-zh/&text=第一次参加量化交易竞赛的方案分享：关于概率预测与优化、端对端学习、与预测实践的心态"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://bigdogmanluo.github.io/2025/12/23/zh/summary_hull_tac-zh/&title=第一次参加量化交易竞赛的方案分享：关于概率预测与优化、端对端学习、与预测实践的心态"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://bigdogmanluo.github.io/2025/12/23/zh/summary_hull_tac-zh/&is_video=false&description=第一次参加量化交易竞赛的方案分享：关于概率预测与优化、端对端学习、与预测实践的心态"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=第一次参加量化交易竞赛的方案分享：关于概率预测与优化、端对端学习、与预测实践的心态&body=Check out this article: https://bigdogmanluo.github.io/2025/12/23/zh/summary_hull_tac-zh/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://bigdogmanluo.github.io/2025/12/23/zh/summary_hull_tac-zh/&title=第一次参加量化交易竞赛的方案分享：关于概率预测与优化、端对端学习、与预测实践的心态"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://bigdogmanluo.github.io/2025/12/23/zh/summary_hull_tac-zh/&title=第一次参加量化交易竞赛的方案分享：关于概率预测与优化、端对端学习、与预测实践的心态"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://bigdogmanluo.github.io/2025/12/23/zh/summary_hull_tac-zh/&title=第一次参加量化交易竞赛的方案分享：关于概率预测与优化、端对端学习、与预测实践的心态"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://bigdogmanluo.github.io/2025/12/23/zh/summary_hull_tac-zh/&title=第一次参加量化交易竞赛的方案分享：关于概率预测与优化、端对端学习、与预测实践的心态"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://bigdogmanluo.github.io/2025/12/23/zh/summary_hull_tac-zh/&name=第一次参加量化交易竞赛的方案分享：关于概率预测与优化、端对端学习、与预测实践的心态&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://bigdogmanluo.github.io/2025/12/23/zh/summary_hull_tac-zh/&t=第一次参加量化交易竞赛的方案分享：关于概率预测与优化、端对端学习、与预测实践的心态"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AF%94%E8%B5%9B%E8%83%8C%E6%99%AF"><span class="toc-number">1.</span> <span class="toc-text">比赛背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E4%BD%93%E6%80%9D%E8%B7%AF%E6%A6%82%E8%BF%B0"><span class="toc-number">2.</span> <span class="toc-text">总体思路概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%89%E6%A6%82%E7%8E%87%E9%A2%84%E6%B5%8B%EF%BC%88Probabilistic-Forecasting%EF%BC%89"><span class="toc-number">2.1.</span> <span class="toc-text">1）概率预测（Probabilistic Forecasting）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%89%E5%8D%95%E6%AD%A5%E4%BB%93%E4%BD%8D%E4%BC%98%E5%8C%96%EF%BC%88Single-step-Position-Optimization%EF%BC%89"><span class="toc-number">2.2.</span> <span class="toc-text">2）单步仓位优化（Single-step Position Optimization）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%89%E9%9B%86%E6%88%90%EF%BC%88Ensembling%EF%BC%89"><span class="toc-number">2.3.</span> <span class="toc-text">3）集成（Ensembling）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%89%E8%B6%85%E5%8F%82%E6%95%B0%E8%B0%83%E4%BC%98%EF%BC%88Hyperparameter-Tuning%EF%BC%89"><span class="toc-number">2.4.</span> <span class="toc-text">4）超参数调优（Hyperparameter Tuning）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%BB%BA%E6%A8%A1"><span class="toc-number">3.</span> <span class="toc-text">问题建模</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A2%E5%8A%A8%E7%8E%87%E6%83%A9%E7%BD%9A-rho-1"><span class="toc-number">3.0.1.</span> <span class="toc-text">波动率惩罚 $\rho_1$</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%AF%B9%E8%A1%A8%E7%8E%B0%E6%83%A9%E7%BD%9A-rho-2"><span class="toc-number">3.0.2.</span> <span class="toc-text">相对表现惩罚 $\rho_2$</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E7%8E%87%E9%A2%84%E6%B5%8B%EF%BC%88Probabilistic-Forecasting%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">概率预测（Probabilistic Forecasting）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B"><span class="toc-number">4.1.</span> <span class="toc-text">特征工程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E4%B8%8E%E9%A2%84%E6%B5%8B%E7%9B%AE%E6%A0%87"><span class="toc-number">4.2.</span> <span class="toc-text">模型与预测目标</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E6%9D%A1%E4%BB%B6%E5%9D%87%E5%80%BC"><span class="toc-number">4.2.1.</span> <span class="toc-text">1）条件均值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E6%9D%A1%E4%BB%B6%E6%96%B9%E5%B7%AE"><span class="toc-number">4.2.2.</span> <span class="toc-text">2）条件方差</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%89%E5%B0%BE%E9%83%A8%E5%88%86%E4%BD%8D%E6%95%B0%EF%BC%88%E7%94%A8%E4%BA%8E-CVaR%EF%BC%89"><span class="toc-number">4.2.3.</span> <span class="toc-text">3）尾部分位数（用于 CVaR）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E9%9B%86%E6%88%90"><span class="toc-number">4.3.</span> <span class="toc-text">模型集成</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8C%96"><span class="toc-number">5.</span> <span class="toc-text">优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%89%E4%BB%85%E6%9C%80%E5%A4%A7%E5%8C%96%E6%94%B6%E7%9B%8A"><span class="toc-number">5.1.</span> <span class="toc-text">1）仅最大化收益</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%89%E5%BC%95%E5%85%A5%E6%96%B9%E5%B7%AE%E6%83%A9%E7%BD%9A%EF%BC%88Sharpe-%E9%A3%8E%E6%A0%BC%E7%9A%84%E4%BB%93%E4%BD%8D%E6%8E%A7%E5%88%B6%EF%BC%89"><span class="toc-number">5.2.</span> <span class="toc-text">2）引入方差惩罚（Sharpe 风格的仓位控制）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%89%E5%BC%95%E5%85%A5-CVaR%E3%80%81%E5%B0%BE%E9%83%A8%E6%96%B9%E5%B7%AE%E4%B8%8E%E6%8D%A2%E6%89%8B%E6%83%A9%E7%BD%9A"><span class="toc-number">5.3.</span> <span class="toc-text">3）引入 CVaR、尾部方差与换手惩罚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CVaR-%E4%B8%8E%E5%B0%BE%E9%83%A8%E4%BA%8C%E9%98%B6%E7%9F%A9%E7%9A%84%E6%95%B0%E5%80%BC%E8%BF%91%E4%BC%BC"><span class="toc-number">5.4.</span> <span class="toc-text">CVaR 与尾部二阶矩的数值近似</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%89%E4%BB%8E-rho-1-%E4%B8%8E-rho-2-%E6%8E%A8%E5%AF%BC%E5%8D%95%E6%AD%A5%E6%83%A9%E7%BD%9A%E9%A1%B9"><span class="toc-number">5.5.</span> <span class="toc-text">4）从 $\rho_1$ 与 $\rho_2$ 推导单步惩罚项</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%88a%EF%BC%89%E6%B3%A2%E5%8A%A8%E7%8E%87%E6%83%A9%E7%BD%9A-rho-1"><span class="toc-number">5.5.1.</span> <span class="toc-text">（a）波动率惩罚 $\rho_1$</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%88b%EF%BC%89%E7%9B%B8%E5%AF%B9%E8%A1%A8%E7%8E%B0%E6%83%A9%E7%BD%9A-rho-2"><span class="toc-number">5.5.2.</span> <span class="toc-text">（b）相对表现惩罚 $\rho_2$</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%88c%EF%BC%89%E6%9C%80%E7%BB%88%E5%8D%95%E6%AD%A5%E6%83%A9%E7%BD%9A%E9%A1%B9"><span class="toc-number">5.5.3.</span> <span class="toc-text">（c）最终单步惩罚项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E7%BB%88%E5%8D%95%E6%AD%A5%E4%BC%98%E5%8C%96%E9%97%AE%E9%A2%98"><span class="toc-number">5.6.</span> <span class="toc-text">最终单步优化问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Evaluation-Results"><span class="toc-number">6.</span> <span class="toc-text">Evaluation Results</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E-End-to-End-Learning"><span class="toc-number">7.</span> <span class="toc-text">关于&quot;End-to-End Learning&quot;</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E5%BF%83%E6%80%81%E4%B8%8E%E9%A2%84%E6%B5%8B%E5%AE%9E%E8%B7%B5%E7%9A%84%E2%80%9C%E4%BF%A1%E6%9D%A1%E2%80%9D"><span class="toc-number">8.</span> <span class="toc-text">关于心态与预测实践的“信条”</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        第一次参加量化交易竞赛的方案分享：关于概率预测与优化、端对端学习、与预测实践的心态
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">BigdogManLuo</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-12-22T16:00:00.000Z" class="dt-published" itemprop="datePublished">2025-12-23</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/Articles/">Articles</a>
    </div>


      

    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p><a href="/2025/12/23/en/summary_hull_tac-en/">English Version</a>
<a href="/2025/12/23/zh/summary_hull_tac-zh/">中文版</a></p>
<p>记录第一次跨界参加超过全球三千支队伍的量化交易竞赛（Kaggle Hull-Tactical Market Prediction）的经历，并分享一下我的方案。虽然此前已经参加过两次正式的时间序列预测竞赛(且都拿到了冠军)，但是这么大规模、竞争激烈的比赛还是头一次。</p>
<p>这场比赛与HEFTCom的赛制相似，完全双盲的评估（预测未来的股票市场收益率并每日调整仓位）。不仅需要作做出预测，更重要的是做出足够好的决策。这也不仅考验机器学习的局部技术，更重要的对问题分析、构建、构建端到端的方案的考验。在离线的walk-forward回测中，我的方案以较小的方差达到了1.33的夏普率，超过了15%的市场夏普基准。解决方案的主体是概率预测（对左尾部概率密度回归和条件方差回归）+随机优化。甚至受诺兰电影《信条》时间钳形战术的启发，还开发了具有风险对冲性质的AB方案。不管结果如何，实战的过程已经是酣畅淋漓了。</p>
<p>虽然不太懂金融市场，但真正的难点并非在市场规则本身，而是在于金融市场的可预测性非常差，没有任何特征能很好解释目标变量，甚至在初步的拟合中，R^2仅在1e-4的数量级，几乎是什么都没学会。如何从噪声时间序列中挖掘价值也是一个有趣的命题。从这场比赛收获的关键的insight是，在高噪声的数据集中，如何控制策略的风险很重要；此外，如何挖掘有价值的预测、如何构建面向评分的决策，两个环节缺一不可。最后发现，概率预测+不确定优化其实是非常有效的工具，这个比赛我的大部分时间也消耗在了数学推导上。kaggle上公开的大部分方案主要只关注了机器学习的管道建模，但并没有涉及问题的数学性质，故也没有用到概率预测、优化。这也是我认为值得分享的意义之一。</p>
<h2 id="比赛背景">比赛背景</h2>
<p>参赛选手需要预测SP500股票在当日买入次日卖出的超额收益率，并决定当日的仓位(0-2)；收益=仓位*超额收益率。以测试窗口长度的夏普率（收益/收益方差）评分，并带有超过市场波动（仓位&gt;1.2）和不积极进行交易的长期惩罚（仓位&lt;1）。决策只能单步进行，也就是只能预测一个点的超额收益率做出单个时刻的决策，且目标函数非凸，因此不能直接对目标进行优化。</p>
<p>以下是对于具体方案的描述，由于采用英文版本书写，详见<a href="/2025/12/23/en/summary_hull_tac-en/">English Version</a>，中文版本则采用翻译工具，带有一定的机翻感。</p>
<h2 id="总体思路概述">总体思路概述</h2>
<p>由于本次比赛中最终的决策变量是<strong>仓位大小</strong> $p_t$，整个问题天然地符合 <strong>Predict-then-Optimize（先预测，再优化）</strong> 的范式：<br>
先从数据中尽可能提取<strong>有用的概率信息</strong>，再基于这些信息设计一个<strong>与官方评分函数显式对齐</strong>的决策规则。</p>
<p>我的整体方案由三个高度耦合的核心模块组成：</p>
<h3 id="1）概率预测（Probabilistic-Forecasting）">1）概率预测（Probabilistic Forecasting）</h3>
<p>我并未依赖单一的点预测，而是训练了一组机器学习回归模型，用来刻画市场超额收益的<strong>条件分布</strong>。具体来说，模型分别用于预测：</p>
<ul>
<li>市场超额收益的条件均值</li>
<li>条件方差</li>
<li>多个左尾分位数（用于近似 CVaR 等尾部风险指标）</li>
</ul>
<p>这样做的动机非常直接：<br>
在一个<strong>信噪比极低</strong>的环境中，单点预测本身是非常脆弱的；而分布层面的信息可以为后续<strong>风险感知型决策</strong>提供更加丰富、稳定的信号。</p>
<h3 id="2）单步仓位优化（Single-step-Position-Optimization）">2）单步仓位优化（Single-step Position Optimization）</h3>
<p>官方比赛的评分函数是在一个滚动时间窗口上定义的，且包含多个<strong>非线性、非凸</strong>的统计量（如 Sharpe 比率、波动率比例、几何平均收益等）。<br>
直接对该窗口级别的评分函数进行优化在实践中是不可行的。</p>
<p>因此，我推导了一个<strong>单时间步的替代优化问题（surrogate objective）</strong>，用于近似评分函数的主导行为。该目标函数显式地包含：</p>
<ul>
<li>方差惩罚（类似 Sharpe Ratio 的风险控制）</li>
<li>CVaR 惩罚（最差尾部情况下的期望损失）</li>
<li>尾部方差惩罚（通过条件二阶矩刻画）</li>
<li>多阶换手惩罚（抑制过度交易）</li>
<li>与官方规则 $\rho_1$ 和 $\rho_2$ 对齐的显式惩罚项</li>
</ul>
<p>这一部分是整个方案中数学推导最为密集的部分：<br>
目标是将一个<strong>窗口级别的评价指标</strong>，转化为一个<strong>稳定、可求解的单步决策问题</strong>。</p>
<h3 id="3）集成（Ensembling）">3）集成（Ensembling）</h3>
<p>在最终阶段，我同时对<strong>模型</strong>和<strong>策略</strong>进行了集成：</p>
<ul>
<li>
<p>多种机器学习模型：</p>
<ul>
<li>LightGBM</li>
<li>CatBoost</li>
<li>XGBoost</li>
</ul>
</li>
<li>
<p>两类交易逻辑：</p>
<ul>
<li>简单的信号驱动仓位规则（与官方 demo notebook 中一致）</li>
<li>基于上述推导得到的<strong>优化型仓位策略</strong></li>
</ul>
</li>
</ul>
<p>集成权重通过 walk-forward 验证进行调优，以在稳健性与性能之间取得平衡。</p>
<h3 id="4）超参数调优（Hyperparameter-Tuning）">4）超参数调优（Hyperparameter Tuning）</h3>
<p>所有惩罚权重、CVaR 置信水平、换手阶数以及集成系数，均通过 <strong>walk-forward 超参数搜索</strong> 进行选择，从而确保最终方案不仅得分高，而且在时间维度上表现稳定。</p>
<h2 id="问题建模">问题建模</h2>
<p>在交易日 $t$，定义：</p>
<ul>
<li>仓位：$p_t$</li>
<li>市场收益率：$r_t^m$</li>
<li>无风险利率：$r_t^f$</li>
<li>市场超额收益：$e_t^m = r_t^m - r_t^f$</li>
</ul>
<p>策略收益为：
$$
r_t^s = r_t^f(1 - p_t) + p_t r_t^m = p_t e_t^m + r_t^f,
$$</p>
<p>策略超额收益为：
$$
e_t^s = r_t^s - r_t^f = p_t e_t^m.
$$</p>
<p>Sharpe Ratio（本次比赛中最重要的指标）定义为：
$$
\text{Sharp}=
\frac{
\left(\prod_{t=1}^{T}(1+e_t^s)\right)^{\frac{1}{T}} - 1
}{
\operatorname{std}({r_t^s}_{t=1}^{T})
}
\sqrt{252}.
$$</p>
<p>即：<strong>年化平均超额收益 / 日收益标准差</strong>。</p>
<p>最终得分在 Sharpe Ratio 的基础上引入两个惩罚项：</p>
<h4 id="波动率惩罚-rho-1">波动率惩罚 $\rho_1$</h4>
<p>当策略年化波动率超过市场波动率的 $1.2$ 倍时，对超出部分进行线性惩罚：</p>

$$
\rho_1=1+\max(0,\frac{std(\{r_t^s\})_{t=1}^T}{std(\{r_t^m\})_{t=1}^T}-1.2)
$$

<h4 id="相对表现惩罚-rho-2">相对表现惩罚 $\rho_2$</h4>
<p>策略不能长期“躺在现金里吃利息”，同时持续跑输市场：
$$
\rho_2=
1 + 0.01 \max\left(
0,
\left[
\left(\prod_{t=1}^{T}(1+e_t^m)\right)^{\frac{1}{T}}-
\left(\prod_{t=1}^{T}(1+e_t^s)\right)^{\frac{1}{T}}
\right]
\cdot 252 \cdot 100
\right).
$$</p>
<p>最终评分函数为：</p>

$$
\text{Score}=
\frac{1}{\rho_1}\cdot\frac{1}{\rho_2}\cdot\text{Sharpe}.
$$

<p>从这些公式可以看出：<br>
$e_t^m$ 是随机变量，而 $p_t$ 是决策变量。<br>
评分主要由 $e_t^s(t=1,\dots,T)$ 与 $\mathrm{std}(r_t^s)$ 决定 —— 本质目标仍然是：<strong>在尽量提高收益的同时，严格控制波动率。</strong></p>
<h2 id="概率预测（Probabilistic-Forecasting）">概率预测（Probabilistic Forecasting）</h2>
<p>我并未在预测模块上投入过多精力，原因主要有两点：</p>
<ol>
<li>特征的解释能力对可预测性的上限约束非常强</li>
<li>我在金融市场上的先验知识有限，因此刻意保持预测部分<strong>轻量、稳健</strong></li>
</ol>
<p>核心思想并不是追求极致精确的点预测，而是从微弱信号中提取尽可能多的<strong>分布信息</strong>，以服务后续的风险感知型决策。</p>
<h3 id="特征工程">特征工程</h3>
<ul>
<li>对 <code>date_id</code> 做对数映射，以捕捉长期趋势</li>
<li>使用周期为 5、21、63、252 个交易日的 Fourier 编码，刻画多尺度季节性</li>
<li>对宏观与情绪类信号加入缺失指示变量</li>
<li>移除高度共线特征，以提升树模型的稳定性</li>
</ul>
<h3 id="模型与预测目标">模型与预测目标</h3>
<p>设市场超额收益为 $e_t^m$。<br>
不同于只建模其条件均值，我将预测任务拆分为<strong>多个回归子任务</strong>，分别对应条件分布的不同方面。</p>
<h4 id="1）条件均值">1）条件均值</h4>
<p>使用 MAE 损失训练标准回归模型：
$$
\mu_t = \mathbb{E}[e_t^m \mid \mathcal{F}_t],
$$
其中 $\mathcal{F}_t$ 表示时刻 $t$ 可用的全部特征。</p>
<h4 id="2）条件方差">2）条件方差</h4>
<p>在均值模型训练完成后，计算残差：
$$
\varepsilon_t = e_t^m - \mu_t,
$$</p>
<p>再训练第二个模型预测条件方差：
$$
\sigma_t^2 \approx \mathbb{E}[\varepsilon_t^2 \mid \mathcal{F}_t].
$$</p>
<p>这一步显式地将<strong>方向性信号</strong>与<strong>不确定性强度</strong>分离开来。</p>
<h4 id="3）尾部分位数（用于-CVaR）">3）尾部分位数（用于 CVaR）</h4>
<p>针对多个尾部水平 $\alpha_1,\ldots,\alpha_M$ 训练分位数回归模型：
$$
q_{\alpha,t} = \inf{x:\mathbb{P}(e_t^m \le x \mid \mathcal{F}_t)\ge \alpha}.
$$</p>
<p>整体而言，该设计的目标是：<br>
在<strong>弱可预测性</strong>条件下，最大化信号利用率 ——<br>
一方面增强特征解释力，另一方面丰富目标变量的分布刻画。</p>
<h3 id="模型集成">模型集成</h3>
<p>所有回归任务（均值、方差、分位数）均采用以下模型的集成：</p>
<ul>
<li>LightGBM</li>
<li>CatBoost</li>
<li>XGBoost</li>
</ul>
<p>选择它们主要是出于稳健性与工程便利性，尤其是对缺失值的原生支持。 为避免不必要的自由度，我在所有分位数层级上使用<strong>相同的集成权重</strong>，实践中效果良好。</p>
<h2 id="优化">优化</h2>
<h3 id="1）仅最大化收益">1）仅最大化收益</h3>
<p>如果我们只考虑最大化期望超额收益，那么单步优化问题可以写为：
$$
\max_{p_t} \mathbb{E}[e_t^s]=
\max_{p_t} p_t \mu_t,
$$
其中 $\mu_t = \mathbb{E}[e_t^m]$ 是预测得到的市场超额收益条件均值。</p>
<p>由于目标函数关于 $p_t$ 是线性的，对其求导可以直接得到<strong>边界解</strong>：</p>
<ul>
<li>若 $\mu_t &lt; 0$，最优解为 $p_t = 0$（不交易）</li>
<li>若 $\mu_t &gt; 0$，则将 $p_t$ 推到上界（例如 $p_t = 2$）</li>
</ul>
<p>这也解释了为什么朴素的“最大化收益”型仓位控制策略，往往会导致<strong>极端仓位</strong>（要么空仓，要么满仓）。</p>
<hr>
<h3 id="2）引入方差惩罚（Sharpe-风格的仓位控制）">2）引入方差惩罚（Sharpe 风格的仓位控制）</h3>
<p>在目标函数中加入方差惩罚项，可以得到一个类似 Sharpe Ratio 的替代优化目标：
$$
\max_{p_t}
p_t \mu_t - \lambda_{\text{var}} p_t^2 \sigma_t^2,
$$
其中 $\sigma_t^2 = \operatorname{Var}(e_t^m)$ 是预测得到的条件方差。</p>
<p>此时，$p_t$ 以二次形式出现在目标函数中，其无约束最优解为：
$$
p_t^\star = \frac{\mu_t}{2\lambda_{\text{var}}\sigma_t^2}.
$$</p>
<p>与纯收益最大化相比，该形式已经能够有效抑制极端杠杆，使得仓位变化更加平滑、连续。</p>
<hr>
<h3 id="3）引入-CVaR、尾部方差与换手惩罚">3）引入 CVaR、尾部方差与换手惩罚</h3>
<p>在上述方差惩罚的基础上，我进一步引入了：</p>
<ul>
<li>下行尾部风险惩罚（CVaR）</li>
<li>左尾“波动率”惩罚（通过条件二阶矩刻画）</li>
<li>高阶滞后换手惩罚，用于平滑交易路径</li>
</ul>
<p>最终得到的实用型单步优化目标为：</p>

$$
\begin{aligned}
\max_{p_t}\quad
& p_t \mu_t
- \lambda_{\mathrm{var}} p_t^2 \sigma_t^2
- \lambda_{\mathrm{cvar}} p_t\, \mathrm{CVaR}_\alpha(e_t^m) \\
& - \lambda_{\mathrm{tail}} p_t^2 \mathbb{E}\!\left[(e_t^m)^2 \mid e_t^m \le q_\alpha\right]
- \lambda_k \left|p_t - \frac{1}{K}\sum_{k=1}^{K} p_{t-k}\right|.
\end{aligned}
$$

<p>其中，$q_\alpha$ 是 $e_t^m$ 在置信水平 $\alpha$ 下的左尾分位数（即 VaR），<br>
CVaR 定义为最差 $\alpha$ 比例结果下的条件期望：</p>

$$
\text{CVaR}_\alpha(e_t^m)=\mathbb{E}\!\left[e_t^m \mid e_t^m \le q_\alpha\right].
$$

<hr>
<h3 id="CVaR-与尾部二阶矩的数值近似">CVaR 与尾部二阶矩的数值近似</h3>
<p>在实践中，我通过<strong>多分位数回归模型</strong>来估计 $q_\alpha$ 与 $\mathrm{CVaR}_\alpha$。</p>
<p>假设模型在一组尾部分位点 $\beta\in(0,\alpha]$ 上给出了预测：
$$
\hat q_{\beta,t}\approx q_\beta(e_t^m\mid \mathcal{F}_t),
$$
则利用 CVaR 的经典恒等式：</p>

$$
\text{CVaR}_\alpha(X)=\frac{1}{\alpha}\int_{0}^{\alpha} q_u(X)\,du,
$$

<p>可以通过数值积分近似：</p>

$$
\widehat{\text{CVaR}}_{\alpha,t}\approx \frac{1}{\alpha}\sum_{j=1}^{M}\hat q_{\beta_j,t}\,\Delta\beta_j,
\quad \Delta\beta_j=\beta_j-\beta_{j-1},\ \beta_M=\alpha.
$$

<p>类似地，尾部方差代理项（条件二阶矩）为：</p>

$$
\mathbb{E}\!\left[X^2\mid X\le q_\alpha\right]=\frac{1}{\alpha}\int_{0}^{\alpha} q_u(X)^2\,du
\ \Rightarrow\
\widehat{m}_{2,\alpha,t}\approx \frac{1}{\alpha}\sum_{j=1}^{M}\hat q_{\beta_j,t}^2\,\Delta\beta_j.
$$

<p>这些<strong>尾部感知型惩罚项</strong>（CVaR + 尾部二阶矩）可以有效避免在预测到重尾下行风险时采取激进仓位；<br>
而换手惩罚项则显著抑制“追噪声”行为。<br>
二者结合，在短评估窗口下能明显提升策略的稳定性与实际 Sharpe 表现。</p>
<hr>
<h3 id="4）从-rho-1-与-rho-2-推导单步惩罚项">4）从 $\rho_1$ 与 $\rho_2$ 推导单步惩罚项</h3>
<p>尽管 $\rho_1$ 与 $\rho_2$ 本身是基于窗口、且形式高度非凸（标准差比、几何均值），<br>
但仍可以推导出<strong>简单而有效的单步 hinge 惩罚项</strong>，来近似其主要作用。</p>
<hr>
<h4 id="（a）波动率惩罚-rho-1">（a）波动率惩罚 $\rho_1$</h4>
<p>回顾定义：</p>

$$
\rho
1 + \max\!\left(
0,
\frac{\operatorname{std}(\{r_t^s\}_{t=1}^{T})}
     {\operatorname{std}(\{r_t^m\}_{t=1}^{T})}-1.2
\right).
$$

<p>由于
$$
r_t^s = r_t^f + p_t e_t^m,
$$
且在窗口内 $r_t^f$ 近似为常数，可得：
$$
\frac{\operatorname{std}({r_t^s})}{\operatorname{std}({r_t^m})}
\approx
\frac{\operatorname{std}({p_t e_t^m})}{\operatorname{std}({e_t^m})}.
$$</p>
<p>设 $x_t = e_t^m,\ w_t = p_t$，利用：
$$
\operatorname{std}^2(w x) = \mathbb{E}[w^2 x^2] - (\mathbb{E}[w x])^2,
$$
并采用日频收益的常见近似（$\mathbb{E}[x]$ 很小），得到：
$$
\operatorname{std}^2(w x) \approx \mathbb{E}[w^2 x^2].
$$</p>
<p>若在窗口内 $w_t$ 变化缓慢，且与 $x_t^2$ 弱相关，则：
$$
\mathbb{E}[w^2 x^2] \approx \mathbb{E}[w^2]\mathbb{E}[x^2].
$$</p>
<p>因此：
$$
\frac{\operatorname{std}(r_t^s)}{\operatorname{std}(r_t^m)}
\approx
\sqrt{\mathbb{E}[p_t^2]}.
$$</p>
<p>这说明 $\rho_1$ 本质上是在惩罚<strong>仓位 RMS 超过 1.2 的情况</strong>。<br>
一个保守且实用的单步替代惩罚为：
$$
\text{pen}_1(p_t) = \lambda_1\max(p_t-1.2,0).
$$</p>
<hr>
<h4 id="（b）相对表现惩罚-rho-2">（b）相对表现惩罚 $\rho_2$</h4>
<p>回顾定义：</p>

$$
\rho_2=
1+0.01 \max\!\left(
0,
\left[
\left(\prod_{t=1}^{T}(1+e_t^m)\right)^{\frac{1}{T}}
-
\left(\prod_{t=1}^{T}(1+e_t^s)\right)^{\frac{1}{T}}
\right]
\cdot 252 \cdot 100
\right).
$$

<p>定义几何平均增长率：
$$
G_m = \left(\prod_{t=1}^{T}(1+e_t^m)\right)^{\frac{1}{T}},
\quad
G_s = \left(\prod_{t=1}^{T}(1+e_t^s)\right)^{\frac{1}{T}}.
$$</p>
<p>取对数：
$$
\log G = \frac{1}{T}\sum_{t=1}^{T}\log(1+e_t).
$$</p>
<p>则有：</p>

$$
\Delta := \log G_m - \log G_s
=
\frac{1}{T}\sum_{t=1}^{T}
\left[
\log(1+e_t^m)-\log(1+p_t e_t^m)
\right].
$$

<p>在日频收益下 $|e_t^m|\ll1$，对数函数可作泰勒展开：
$$
\log(1+z)=z-\frac{z^2}{2}+O(z^3).
$$</p>
<p>从而得到：
$$
\log(1+e_t^m)-\log(1+p_t e_t^m)
\approx
(1-p_t)e_t^m-\frac{1-p_t^2}{2}(e_t^m)^2.
$$</p>
<p>因此：</p>

$$
\Delta
\approx
\frac{1}{T}\sum_{t=1}^{T}(1-p_t)e_t^m
-
\frac{1}{2T}\sum_{t=1}^{T}(1-p_t^2)(e_t^m)^2.
$$

<p>第一项为一阶项，在日频下通常占主导。<br>
若假设市场长期超额收益为正，则 $\Delta$ 的符号主要由 $(1-p_t)$ 决定：</p>
<ul>
<li>$p_t&lt;1$：$\Delta&gt;0$，策略长期跑输市场</li>
<li>$p_t&gt;1$：$\Delta&lt;0$，策略不再明显劣于市场</li>
</ul>
<p>回到原始空间，有近似：
$$
G_m - G_s \approx G_s,\Delta.
$$</p>
<p>将所有常数项吸收到可调权重中，可得单步替代惩罚：
$$
\text{pen}_2(p_t)=\lambda_2\max(1-p_t,0).
$$</p>
<hr>
<h4 id="（c）最终单步惩罚项">（c）最终单步惩罚项</h4>
<p>综合上述两项：
$$
\lambda_{1}\max(p_t-1.2,0)+\lambda_{2}\max(1-p_t,0).
$$</p>
<hr>
<h3 id="最终单步优化问题">最终单步优化问题</h3>
<p>将所有项合并，最终的单步优化目标为：</p>

$$
\begin{aligned}
\max_{p_t} \mathcal{J}(p_t)=
p_t \mu_t
-\lambda_{\text{var}} p_t^2 \sigma_t^2
-\lambda_{\text{cvar}} p_t \,\widehat{\text{CVaR}}_{\alpha,t}
-\lambda_{\text{tail}} p_t^2 \widehat{m}_{2,\alpha,t}\\
-\lambda_k \left|p_t - \frac{1}{K}\sum_{k=1}^{K} p_{t-k}\right|
-\lambda_{1}\max(p_t-1.2,0)
-\lambda_{2}\max(1-p_t,0).
\end{aligned}
$$

<p>该目标函数虽然是非凸的，但仅涉及单一变量 $p_t$。<br>
使用 Big-M 或 MIP 求解显然是杀鸡用牛刀，因此我直接采用<strong>网格搜索（grid search）</strong>，在实践中速度快且非常稳健。</p>
<h2 id="Evaluation-Results">Evaluation Results</h2>
<p>在比赛提供的public训练集上进行了walk-forward回测。初始的训练集窗口长度为5186，验证集的窗口长度为125个交易日。最终版本的方案在所有fold上的测试结果如下：</p>
<p><img src="/2025/12/23/zh/summary_hull_tac-zh/walk_forward_score_distribution.png" alt="scores in walk-forward backtesting"></p>
<h2 id="关于-End-to-End-Learning">关于&quot;End-to-End Learning&quot;</h2>
<p>尽管端对端的预测后优化是很火的，但是经过了几次预测实践后仍然感悟到，当前很难真正做到在预测模型中做到以决策价值来训练预测。一个很重要的阻碍在于，对于这样一个单步预测和决策，但是评估总体的分数的问题而言，我们无法将决策价值构建一个闭式的formulation，也无法建立为一个凸优化问题。因此，我们也无法知道模型的一个单步预测值究竟有什么样的价值。 再者就是端对端训练引入的额外复杂性，抛弃那些高效率的ML训练框架(gradient boosting)来做嵌入了决策模型的端对端的训练，不仅给自己找了很多的不痛快，反而难以将模型训练到一个简单而合理的representation。如我之前的post所说，ML回归的representation其实应该足够简单才是合理的，剩下的都属于一种特征工程。此外引入的end-to-end的loss往往会让loss landscape是病态的，训练的过程很容易产生振荡.</p>
<p>但是，预测的价值仍然是一个有趣且值得深思的问题。在股票市场里，尽管R^2仅仅维持在0附近的量级，但是在市场里，它依然是有效可以赚钱的信息，这也是很神奇的事情。此外，虽然预测模型没有用价值导向的方式训练，但是超参数搜索仍然可以以决策效益来评估。这一点是非常实用的。因为超参数搜索内涵的优化本地本就是无法正常建模的，是通过trails的启发式策略来优化的。既然如此，那么此时的目的不再是优化预测的准确度量了，以决策效益来优化超参数本身就是合理的。</p>
<p>总结来说，对于End-to-End Learning，我的看法是：</p>
<ul>
<li>模型的参数应使用高效框架训练，使用简单、平滑的统计损失</li>
<li>超参数可以通过基于试验的方法直接根据决策指标（分数/效用）进行调优，因为超参数参数量会少很多，搜索空间更小，且在该层面进行完整的端到端训练的复杂度比参数层面更容易管理。</li>
</ul>
<h2 id="关于心态与预测实践的“信条”">关于心态与预测实践的“信条”</h2>
<p>由于有限的可预测性和测试窗口长度，这仍然是一场随机性驱动的比赛。有时候甚至会对时间序列预测产生怀疑。我们做的预测在未来真的有效吗？我相信每个forecaster都无法保证这点。在最后开发完方案看到离线验证的结果时，是喜悦但又夹杂无力的。虽然已经在平均上击败了市场，但是看到那些仍然分数低到离谱的fold仍然会对预测这门学问产生怀疑、失落。这就是一个统计学的游戏，没有任何的方案能让所有的样本点都最好。all the best就是过拟合的陷阱。关键是，未来会是那些坏的样本点出现吗？谁也不知道。</p>
<p>究其原因，还是因为自己过于在意输赢。但认真来想，完赛并总结分享方案已经这场比赛的意义。尽管Kaggle上充斥着这是一个运气驱动的比赛，即便我知道最终的测试排行榜具有极大的随机性，因为只有非常短的测试窗口。可是又如何呢？唯一能做的，就是不停的分析数据、推导理论，优化算法，提升方法的统计性能。不要过于乐观好的样本，也不要被坏的样本干扰心态。一定要坚信统计学的力量，只有时间会证明一切。或许，这就是一种预测的信仰吧。</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="https://bigdogmanluo.github.io/academic-homepage/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AF%94%E8%B5%9B%E8%83%8C%E6%99%AF"><span class="toc-number">1.</span> <span class="toc-text">比赛背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E4%BD%93%E6%80%9D%E8%B7%AF%E6%A6%82%E8%BF%B0"><span class="toc-number">2.</span> <span class="toc-text">总体思路概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%89%E6%A6%82%E7%8E%87%E9%A2%84%E6%B5%8B%EF%BC%88Probabilistic-Forecasting%EF%BC%89"><span class="toc-number">2.1.</span> <span class="toc-text">1）概率预测（Probabilistic Forecasting）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%89%E5%8D%95%E6%AD%A5%E4%BB%93%E4%BD%8D%E4%BC%98%E5%8C%96%EF%BC%88Single-step-Position-Optimization%EF%BC%89"><span class="toc-number">2.2.</span> <span class="toc-text">2）单步仓位优化（Single-step Position Optimization）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%89%E9%9B%86%E6%88%90%EF%BC%88Ensembling%EF%BC%89"><span class="toc-number">2.3.</span> <span class="toc-text">3）集成（Ensembling）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%89%E8%B6%85%E5%8F%82%E6%95%B0%E8%B0%83%E4%BC%98%EF%BC%88Hyperparameter-Tuning%EF%BC%89"><span class="toc-number">2.4.</span> <span class="toc-text">4）超参数调优（Hyperparameter Tuning）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%BB%BA%E6%A8%A1"><span class="toc-number">3.</span> <span class="toc-text">问题建模</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A2%E5%8A%A8%E7%8E%87%E6%83%A9%E7%BD%9A-rho-1"><span class="toc-number">3.0.1.</span> <span class="toc-text">波动率惩罚 $\rho_1$</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%AF%B9%E8%A1%A8%E7%8E%B0%E6%83%A9%E7%BD%9A-rho-2"><span class="toc-number">3.0.2.</span> <span class="toc-text">相对表现惩罚 $\rho_2$</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E7%8E%87%E9%A2%84%E6%B5%8B%EF%BC%88Probabilistic-Forecasting%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">概率预测（Probabilistic Forecasting）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B"><span class="toc-number">4.1.</span> <span class="toc-text">特征工程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E4%B8%8E%E9%A2%84%E6%B5%8B%E7%9B%AE%E6%A0%87"><span class="toc-number">4.2.</span> <span class="toc-text">模型与预测目标</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E6%9D%A1%E4%BB%B6%E5%9D%87%E5%80%BC"><span class="toc-number">4.2.1.</span> <span class="toc-text">1）条件均值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E6%9D%A1%E4%BB%B6%E6%96%B9%E5%B7%AE"><span class="toc-number">4.2.2.</span> <span class="toc-text">2）条件方差</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%89%E5%B0%BE%E9%83%A8%E5%88%86%E4%BD%8D%E6%95%B0%EF%BC%88%E7%94%A8%E4%BA%8E-CVaR%EF%BC%89"><span class="toc-number">4.2.3.</span> <span class="toc-text">3）尾部分位数（用于 CVaR）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E9%9B%86%E6%88%90"><span class="toc-number">4.3.</span> <span class="toc-text">模型集成</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8C%96"><span class="toc-number">5.</span> <span class="toc-text">优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%89%E4%BB%85%E6%9C%80%E5%A4%A7%E5%8C%96%E6%94%B6%E7%9B%8A"><span class="toc-number">5.1.</span> <span class="toc-text">1）仅最大化收益</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%89%E5%BC%95%E5%85%A5%E6%96%B9%E5%B7%AE%E6%83%A9%E7%BD%9A%EF%BC%88Sharpe-%E9%A3%8E%E6%A0%BC%E7%9A%84%E4%BB%93%E4%BD%8D%E6%8E%A7%E5%88%B6%EF%BC%89"><span class="toc-number">5.2.</span> <span class="toc-text">2）引入方差惩罚（Sharpe 风格的仓位控制）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%89%E5%BC%95%E5%85%A5-CVaR%E3%80%81%E5%B0%BE%E9%83%A8%E6%96%B9%E5%B7%AE%E4%B8%8E%E6%8D%A2%E6%89%8B%E6%83%A9%E7%BD%9A"><span class="toc-number">5.3.</span> <span class="toc-text">3）引入 CVaR、尾部方差与换手惩罚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CVaR-%E4%B8%8E%E5%B0%BE%E9%83%A8%E4%BA%8C%E9%98%B6%E7%9F%A9%E7%9A%84%E6%95%B0%E5%80%BC%E8%BF%91%E4%BC%BC"><span class="toc-number">5.4.</span> <span class="toc-text">CVaR 与尾部二阶矩的数值近似</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%89%E4%BB%8E-rho-1-%E4%B8%8E-rho-2-%E6%8E%A8%E5%AF%BC%E5%8D%95%E6%AD%A5%E6%83%A9%E7%BD%9A%E9%A1%B9"><span class="toc-number">5.5.</span> <span class="toc-text">4）从 $\rho_1$ 与 $\rho_2$ 推导单步惩罚项</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%88a%EF%BC%89%E6%B3%A2%E5%8A%A8%E7%8E%87%E6%83%A9%E7%BD%9A-rho-1"><span class="toc-number">5.5.1.</span> <span class="toc-text">（a）波动率惩罚 $\rho_1$</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%88b%EF%BC%89%E7%9B%B8%E5%AF%B9%E8%A1%A8%E7%8E%B0%E6%83%A9%E7%BD%9A-rho-2"><span class="toc-number">5.5.2.</span> <span class="toc-text">（b）相对表现惩罚 $\rho_2$</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%88c%EF%BC%89%E6%9C%80%E7%BB%88%E5%8D%95%E6%AD%A5%E6%83%A9%E7%BD%9A%E9%A1%B9"><span class="toc-number">5.5.3.</span> <span class="toc-text">（c）最终单步惩罚项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E7%BB%88%E5%8D%95%E6%AD%A5%E4%BC%98%E5%8C%96%E9%97%AE%E9%A2%98"><span class="toc-number">5.6.</span> <span class="toc-text">最终单步优化问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Evaluation-Results"><span class="toc-number">6.</span> <span class="toc-text">Evaluation Results</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E-End-to-End-Learning"><span class="toc-number">7.</span> <span class="toc-text">关于&quot;End-to-End Learning&quot;</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E5%BF%83%E6%80%81%E4%B8%8E%E9%A2%84%E6%B5%8B%E5%AE%9E%E8%B7%B5%E7%9A%84%E2%80%9C%E4%BF%A1%E6%9D%A1%E2%80%9D"><span class="toc-number">8.</span> <span class="toc-text">关于心态与预测实践的“信条”</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://bigdogmanluo.github.io/2025/12/23/zh/summary_hull_tac-zh/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://bigdogmanluo.github.io/2025/12/23/zh/summary_hull_tac-zh/&text=第一次参加量化交易竞赛的方案分享：关于概率预测与优化、端对端学习、与预测实践的心态"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://bigdogmanluo.github.io/2025/12/23/zh/summary_hull_tac-zh/&title=第一次参加量化交易竞赛的方案分享：关于概率预测与优化、端对端学习、与预测实践的心态"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://bigdogmanluo.github.io/2025/12/23/zh/summary_hull_tac-zh/&is_video=false&description=第一次参加量化交易竞赛的方案分享：关于概率预测与优化、端对端学习、与预测实践的心态"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=第一次参加量化交易竞赛的方案分享：关于概率预测与优化、端对端学习、与预测实践的心态&body=Check out this article: https://bigdogmanluo.github.io/2025/12/23/zh/summary_hull_tac-zh/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://bigdogmanluo.github.io/2025/12/23/zh/summary_hull_tac-zh/&title=第一次参加量化交易竞赛的方案分享：关于概率预测与优化、端对端学习、与预测实践的心态"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://bigdogmanluo.github.io/2025/12/23/zh/summary_hull_tac-zh/&title=第一次参加量化交易竞赛的方案分享：关于概率预测与优化、端对端学习、与预测实践的心态"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://bigdogmanluo.github.io/2025/12/23/zh/summary_hull_tac-zh/&title=第一次参加量化交易竞赛的方案分享：关于概率预测与优化、端对端学习、与预测实践的心态"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://bigdogmanluo.github.io/2025/12/23/zh/summary_hull_tac-zh/&title=第一次参加量化交易竞赛的方案分享：关于概率预测与优化、端对端学习、与预测实践的心态"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://bigdogmanluo.github.io/2025/12/23/zh/summary_hull_tac-zh/&name=第一次参加量化交易竞赛的方案分享：关于概率预测与优化、端对端学习、与预测实践的心态&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://bigdogmanluo.github.io/2025/12/23/zh/summary_hull_tac-zh/&t=第一次参加量化交易竞赛的方案分享：关于概率预测与优化、端对端学习、与预测实践的心态"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2025
    BigdogManLuo
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="https://bigdogmanluo.github.io/academic-homepage/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
